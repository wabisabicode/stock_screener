<!DOCTYPE html>
<html>
  <head>
	<meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Stock Data</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  </head>
  <body>
    <div class="container">
      <table id="stock-table" class="table table-hover table-striped caption-top">
        <caption>Stock Data</caption>
        <thead>
          <tr class="table-primary">
            <th>Stock</th>
            <th>Equity Ratio (%)</th>
            <th>Net Debt/ EBITDA</th>
            <th>Inv/Rev MRQ (%)</th>
            <th>Avg. Inv/Rev (%)</th>
            <th></th>
            <th>qRev Growth YoY (%)</th>
            <th>avRev Growth Y (%)</th>
            <th>MRQ Gross Mar (%)</th>
            <th>Avg. Gross Mar Y (%)</th>
            <th>MRQ OCF (%)</th>
            <th>Avg. OCF Y (%)</th>
            <th>MRQ FCF (%)</th>
            <th>Avg. FCF Y (%)</th>
            <th>MRQ</th>
            <th>Remark</th>
            <th></th>
            <th>EV/Sale</th>
            <th>P/OCF</th>
          </tr>
        </thead>
        <tbody class="table-group-divider">
          {% for item in data %}
            {% if item %}
              <tr>
                <td>{{ item.symbol }}</td>
                <td>{{ '%5.0f%%' % item.equity_ratio|float }}</td>
                <td>{{ '%4.1f' % item.net_debt_to_ebitda|float }}</td>
                <td>{{ '%5.0f%%' % item.inv_to_rev_mrq|float }}</td>
                <td>{{ '%5.0f%%' % item.avg_inv_to_rev|float }}</td>
                <td>{{ '\t' }}</td>
                <td>{{ '%5.0f%%' % item.q_rev_growth|float }}</td>
                <td>{{ '%5.0f%%' % item.av_rev_growth|float }}</td>
                <td>{{ '%5.0f%%' % item.mrq_gp_margin|float }}</td>
                <td>{{ '%5.0f%%' % item.av_gp_margin|float }}</td>
                <td>{{ '%5.0f%%' % item.mrq_ocf_margin|float }}</td>
                <td>{{ '%5.0f%%' % item.av_ocf_margin|float }}</td>
                <td>{{ '%5.0f%%' % item.mrq_fcf_margin|float }}</td>
                <td>{{ '%5.0f%%' % item.av_fcf_margin|float }}</td>
                <td>{{ item.as_of_date }}</td>
                <td>{{ item.remarks }}</td>
                <td>{{ '\t' }}</td>
                <td>{{ '%5.2f' % item.ev_to_rev|float }}</td>
                <td>{{ '%6.2f' % item.p_to_ocf|float }}</td>
              </tr>
            {% else %}
              <tr>
                <td>&nbsp;</td>
                <td>{{ '\t' }}</td>
                <td>{{ '\t' }}</td>
                <td>{{ '\t' }}</td>
                <td>{{ '\t' }}</td>
                <td>{{ '\t' }}</td>
                <td>{{ '\t' }}</td>
                <td>{{ '\t' }}</td>
                <td>{{ '\t' }}</td>
                <td>{{ '\t' }}</td>
                <td>{{ '\t' }}</td>
                <td>{{ '\t' }}</td>
                <td>{{ '\t' }}</td>
                <td>{{ '\t' }}</td>
                <td>{{ '\t' }}</td>
                <td>{{ '\t' }}</td>
                <td>{{ '\t' }}</td>
                <td>{{ '\t' }}</td>
                <td>{{ '\t' }}</td>
              </tr>
            {% endif %}
          {% endfor %}
        </tbody>
      </table>

      <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.3.2/socket.io.js" integrity="sha384-wcXqvoBsDlnHQ3+BaHclhPmRnQ1FbTbJgsGj1vUZcECqgRbkMp4JUHPcHYL+6Hva" crossorigin="anonymous"></script> -->
      <script src="/static/socket.io.js"></script>
      <script>
          var socket = io.connect('http://127.0.0.1:5000');
          // var socket = io.connect('http://' + document.domain + ':' + location.port);

          socket.on('update_data', function(new_data) {
              var stockTable = document.getElementById('stock-table');
              // Clear existing rows except for the header row
              while (stockTable.rows.length > 1) {
                  stockTable.deleteRow(1);
              }
              // Add new rows for each item in new_data
              new_data.forEach(function(item) {
                  var newRow = stockTable.insertRow(-1);
                  var cellIndex = 0;
                  // Loop through each property of the item object
                  for (var key in item) {
                      var newCell = newRow.insertCell(cellIndex++);
                      // Format cell content according to data type
                      if (key === 'symbol') {
                          newCell.textContent = item[key];
                      } else if (key === 'remarks_ui') {
                          newCell.textContent = item[key];
                      } else {
                          newCell.textContent = (typeof item[key] === 'number') ? item[key].toFixed(2) : item[key];
                      }
                  }
              });
          });
      </script>
    </div>
  </body>
</html>

